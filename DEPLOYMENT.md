# WASHNET - AWS EC2 Deployment Guide

This guide will help you deploy your WASHNET Laundry Management System to an AWS EC2 instance.

## Prerequisites

1. AWS EC2 instance running (Ubuntu 20.04/22.04 recommended)
2. SSH access to your EC2 instance
3. A GitHub/GitLab/Bitbucket account (or any Git repository hosting)

## Step 1: Initialize Git Repository (Local)

If you haven't already, initialize a git repository:

```bash
cd c:\xampp\htdocs\laundrys
git init
git add .
git commit -m "Initial commit - WASHNET Laundry System"
```

## Step 2: Push to Remote Repository

### Option A: GitHub (Recommended)

1. Create a new repository on GitHub (don't initialize with README)
2. Add remote and push:

```bash
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git
git branch -M main
git push -u origin main
```

### Option B: GitLab

```bash
git remote add origin https://gitlab.com/YOUR_USERNAME/YOUR_REPO_NAME.git
git branch -M main
git push -u origin main
```

## Step 3: EC2 Instance Setup

### 3.1 Connect to Your EC2 Instance

```bash
ssh -i your-key.pem ubuntu@your-ec2-ip-address
```

### 3.2 Install Required Software

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install PHP 8.2 and extensions
sudo apt install -y software-properties-common
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
sudo apt install -y php8.2 php8.2-cli php8.2-common php8.2-mysql php8.2-zip php8.2-gd php8.2-mbstring php8.2-curl php8.2-xml php8.2-bcmath php8.2-sqlite3

# Install Composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer

# Install Node.js and npm
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Install Git
sudo apt install -y git

# Install Apache and enable modules
sudo apt install -y apache2
sudo a2enmod rewrite
sudo a2enmod headers

# Install MySQL (if you want to use MySQL instead of SQLite)
sudo apt install -y mysql-server
```

### 3.3 Clone Your Repository

```bash
cd /var/www
sudo git clone https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git laundry
sudo chown -R $USER:$USER /var/www/laundry
cd laundry
```

## Step 4: Backend Setup (Laravel)

```bash
cd /var/www/laundry/laundry-backend

# Install dependencies
composer install --no-dev --optimize-autoloader

# Copy environment file
cp .env.example .env

# Generate application key
php artisan key:generate

# Edit .env file (see Configuration section below)
nano .env

# Run migrations
php artisan migrate --force

# Create storage link
php artisan storage:link

# Optimize Laravel
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

### Backend .env Configuration

Edit `/var/www/laundry/laundry-backend/.env`:

```env
APP_NAME=WASHNET
APP_ENV=production
APP_KEY=base64:... (generated by key:generate)
APP_DEBUG=false
APP_URL=http://your-domain.com

DB_CONNECTION=sqlite
# OR if using MySQL:
# DB_CONNECTION=mysql
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=washnet
# DB_USERNAME=your_db_user
# DB_PASSWORD=your_db_password

# Create admin user
php artisan tinker
```

In tinker:
```php
$admin = new App\Models\User();
$admin->name = 'Admin';
$admin->email = 'admin@washnet.com';
$admin->password = Hash::make('your-secure-password');
$admin->role = 'admin';
$admin->save();
exit
```

## Step 5: Frontend Setup (React)

```bash
cd /var/www/laundry/laundry-frontend

# Install dependencies
npm install

# Create .env file
echo "REACT_APP_API_URL=http://your-domain.com/api" > .env
echo "REACT_APP_WEATHER_API_KEY=your-openweathermap-api-key" >> .env

# Build for production
npm run build
```

## Step 6: Apache Configuration

### 6.1 Create Apache Virtual Host

```bash
sudo nano /etc/apache2/sites-available/washnet.conf
```

Add this configuration:

```apache
<VirtualHost *:80>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    
    # Frontend (React)
    DocumentRoot /var/www/laundry/laundry-frontend/build
    
    <Directory /var/www/laundry/laundry-frontend/build>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # React Router support
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Backend API (Laravel)
    Alias /api /var/www/laundry/laundry-backend/public
    
    <Directory /var/www/laundry/laundry-backend/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        RewriteEngine On
        RewriteBase /api
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ /api/index.php/$1 [L]
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/washnet_error.log
    CustomLog ${APACHE_LOG_DIR}/washnet_access.log combined
</VirtualHost>
```

### 6.2 Enable Site and Restart Apache

```bash
sudo a2ensite washnet.conf
sudo a2dissite 000-default.conf  # Disable default site
sudo systemctl restart apache2
```

## Step 7: Configure Firewall

```bash
sudo ufw allow 'Apache Full'
sudo ufw allow ssh
sudo ufw enable
```

## Step 8: Set Up SSL (Optional but Recommended)

### Using Let's Encrypt (Free SSL)

```bash
sudo apt install -y certbot python3-certbot-apache
sudo certbot --apache -d your-domain.com -d www.your-domain.com
```

## Step 9: Update Frontend API URL

Update your frontend to use the production API URL. You can also use a reverse proxy configuration or update the React build with environment variables.

## Quick Deployment Script

I've created `deploy.sh` that automates most of this process. Upload it to your EC2 instance and run:

```bash
chmod +x deploy.sh
./deploy.sh
```

## Updating Your Application

When you make changes:

```bash
# On local machine
git add .
git commit -m "Update description"
git push

# On EC2 instance
cd /var/www/laundry
git pull
cd laundry-backend
composer install --no-dev --optimize-autoloader
php artisan migrate --force
php artisan config:cache
php artisan route:cache
cd ../laundry-frontend
npm install
npm run build
sudo systemctl restart apache2
```

## Troubleshooting

### Check Apache Logs
```bash
sudo tail -f /var/log/apache2/washnet_error.log
```

### Check Laravel Logs
```bash
tail -f /var/www/laundry/laundry-backend/storage/logs/laravel.log
```

### Permissions Issues
```bash
sudo chown -R www-data:www-data /var/www/laundry
sudo chmod -R 755 /var/www/laundry
sudo chmod -R 775 /var/www/laundry/laundry-backend/storage
```

### Test API Endpoint
```bash
curl http://localhost/api/orders/search?customer_name=test
```

## Security Checklist

- [ ] Set `APP_DEBUG=false` in `.env`
- [ ] Use strong database passwords
- [ ] Configure firewall (UFW)
- [ ] Set up SSL certificate
- [ ] Restrict file permissions
- [ ] Keep software updated
- [ ] Use environment variables for secrets
- [ ] Set up regular backups

## Alternative: Using Nginx

If you prefer Nginx over Apache, see `nginx.conf.example` for configuration.

---

**Need Help?** Check the main README-Washnet.md for application-specific details.
